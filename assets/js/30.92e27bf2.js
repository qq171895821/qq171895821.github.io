(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{620:function(t,s,i){"use strict";i.r(s);var m=i(0),v=Object(m.a)({},(function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[i("div",{staticClass:"custom-block tip"},[i("p",[t._v("dy 设备注册device_register逆向分析")])]),t._v(" "),i("p",[t._v("首先抓个包看请求格式， 分析仍然采用的6.8.0版本")]),t._v(" "),i("p",[i("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/JJymsWorld/Jymscloudiimmgg@main/img/20210708224525.png",alt:""}})]),t._v(" "),i("p",[t._v("可以看到为post请求，其中加密参数有xsstub, Xgorgon, xsqueries（这个不带也没关系）")]),t._v(" "),i("p",[i("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/JJymsWorld/Jymscloudiimmgg@main/img/20210708224648.png",alt:""}})]),t._v(" "),i("p",[t._v("请求体body部分进行了加密。这个地方待会我们会分析到。")]),t._v(" "),i("p",[t._v("app直接拖入jadx分析下代码。直接搜索device_register，得到的结果不多。大致看了一下基本上就定位在了这个函数。")]),t._v(" "),i("p",[i("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/JJymsWorld/Jymscloudiimmgg@main/img/20210716190434.png",alt:""}})]),t._v(" "),i("p",[t._v("其中参数str可以hook一下打印出来，hook代码我就不放了，大家可以自行研究很简单。str参数其实就是请求的url。然后我们往下看。")]),t._v(" "),i("p",[i("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/JJymsWorld/Jymscloudiimmgg@main/img/20210708230217.png",alt:""}})]),t._v(" "),i("p",[t._v("可以看到这里事实上是有一个z5控制是否使用加密体，如果z5为true的话就发送的加密体的请求，反之发送明文。所以这里就有一个思路，如果逆向查看加密体未加密前是什么样子，可以通过hook使z5为false，这样抓包看到的请求就是明文了。")]),t._v(" "),i("p",[t._v("由于只是分享思路，细节上面处理就不多说了，z5这个也很容易跟踪到，自己可以稍微研究下。")]),t._v(" "),i("p",[t._v("明文大概是下面这样子")]),t._v(" "),i("p",[i("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/JJymsWorld/Jymscloudiimmgg@main/img/20210708230543.png",alt:""}})]),t._v(" "),i("p",[t._v("下面分析下加密的部分，直接跟进刚刚那个加密的部分调用函数")]),t._v(" "),i("p",[i("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/JJymsWorld/Jymscloudiimmgg@main/img/20210708230801.png",alt:""}})]),t._v(" "),i("p",[i("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/JJymsWorld/Jymscloudiimmgg@main/img/20210708231003.png",alt:""}})]),t._v(" "),i("p",[t._v("从上图可以跟踪到加密请求体的获取是调用了TTEncryptUtils.a这个函数，请求的参数就是上面的明文转成byte[]类型，可以通过hook TTEncryptUtils.a这个函数打印参数将byte[]转回字符串查看，我们继续跟进函数。")]),t._v(" "),i("p",[i("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/JJymsWorld/Jymscloudiimmgg@main/img/20210716191027.png",alt:""}})]),t._v(" "),i("p",[t._v("这里就很清晰明了了，加密部分的算法在native层，a函数里面调用handleData这个函数获取加密体。")]),t._v(" "),i("p",[t._v("下面的分析就要跟进到so文件里面去分析他的算法了，这里就不在分析，有兴趣的可以自行研究下。")]),t._v(" "),i("p",[t._v("事实上分析到这里，我们就已经可以通过hook来调用他方法获取返回的加密体，只需要构建好参数即可。")]),t._v(" "),i("p",[i("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/JJymsWorld/Jymscloudiimmgg@main/img/20210708231833.png",alt:""}})]),t._v(" "),i("p",[t._v("这里是返回的结果，然后我们放到请求里测试看是否可用")]),t._v(" "),i("p",[i("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/JJymsWorld/Jymscloudiimmgg@main/img/20210708232305.png",alt:""}})]),t._v(" "),i("p",[t._v("成功返回注册出的device_id 和install_id")]),t._v(" "),i("p",[t._v("当然这样注册出的device_id 和install_id 是不可用的，还需要激活后才能使用。")]),t._v(" "),i("p",[t._v("关注一下，后续还会分享其他算法的分析思路。")]),t._v(" "),i("p",[t._v("技术交流或者有疑问可发邮件至:JJJJym@outlook.com")]),t._v(" "),i("h2",{attrs:{id:"声明"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#声明"}},[t._v("#")]),t._v(" 声明")]),t._v(" "),i("ol",[i("li",[t._v("本人纯粹技术爱好者，如若有侵犯抖音权益，请立即告知，立刻删除。")]),t._v(" "),i("li",[t._v("原创文章，禁止转载")]),t._v(" "),i("li",[t._v("请勿使用本技术用于非法行为。")])])])}),[],!1,null,null,null);s.default=v.exports}}]);